
current_selected_value=null;function BuildCork(){window.location="corkboard.php?boardid="+$('#board_select option:selected ').val();}function BuildToolbar(page){html='<span id="span_menu">';html+='<input type="radio" id="menu"      name="menu" /> <label for="menu">Menu</label>';html+='<input type="radio" id="help" name="menu" />  <label for="help">Help</label>';html+='<input type="radio" id="logout"    name="menu" /> <label for="logout">Logout</label>';html+='</span>';document.getElementById('toolbar').innerHTML=html;$(document).ready(function(){$(function(){$("#span_menu").buttonset();});$('#'+page).attr('checked',true);$('#logout').click(function(){window.location="logout.php";});});}function toggleDescriptionOn(div_id){toggleDescriptionOff();RequestFormByAjaxPost(div_id);$('#'+div_id).toggleClass('ui-helper-hidden',false);current_selected_value=div_id;}function toggleDescriptionOff(){if(current_selected_value!=null){$('#'+current_selected_value).toggleClass('ui-helper-hidden',true);}}function toggleContactType(value){if(value!=('0')){$('#contact_info').toggleClass('ui-helper-hidden',false);}else{$('#contact_info').toggleClass('ui-helper-hidden',true);}}function toggleShuffleFeature(value){$('#interval').toggleClass('ui-helper-hidden',value);$('#label_interval').toggleClass('ui-helper-hidden',value);}function toggleManagerActionsOff(){$('#ltext_preview').toggleClass('ui-state-active',false);$('#ltext_edit').toggleClass('ui-state-active',false);$('#ltext_remove').toggleClass('ui-state-active',false);$('#ltext_image_preview').toggleClass('ui-state-active',false);$('#ltext_image_edit').toggleClass('ui-state-active',false);$('#ltext_image_remove').toggleClass('ui-state-active',false);$('#limage_preview').toggleClass('ui-state-active',false);$('#limage_edit').toggleClass('ui-state-active',false);$('#limage_remove').toggleClass('ui-state-active',false);}function togglePayPerSpaceFeature(value){if(value!=('none')){$('#cashamount').toggleClass('ui-helper-hidden',false);$('#label_cashamount').toggleClass('ui-helper-hidden',false);$('#flyerdays').toggleClass('ui-helper-hidden',false);$('#label_flyerdays').toggleClass('ui-helper-hidden',false);}else{$('#cashamount').toggleClass('ui-helper-hidden',true);$('#label_cashamount').toggleClass('ui-helper-hidden',true);$('#flyerdays').toggleClass('ui-helper-hidden',true);$('#label_flyerdays').toggleClass('ui-helper-hidden',true);}}function preview_flyer(id){window.open('generate.php?flyerid='+id,null,'height=600,width=800,status=no,toolbar=no,menubar=no,location=no');self.close();}function cleanContentAndFormFields(){$('#content').html("");$('#form_content').html("");}function ActivateSelectableContent(){$(function(){$('#text_radio').buttonset();$('#text_image_radio').buttonset();$('#image_radio').buttonset();});$('#text_preview').click(function(){if($('#tex_flyer_select option:selected').val()=='0'){$('#status_messages').html("<label style='color: #9BCC60;'>Messages: Please select a flyer first!</label>");return false;}window.open('generate.php?flyerid='+$('#text_flyer_select option:selected').val(),null,'height=600,width=800,status=no,toolbar=no,menubar=no,location=no');self.close();});$('#text_edit').click(function(){if($('#text_flyer_select option:selected').val()=='0'){$('#status_messages').html("<label style='color: #9BCC60;'>Messages: Please select a flyer first!</label>");return false;}LaunchEditorModal($('#text_flyer_select option:selected').val(),'text',false);});$('#text_remove').click(function(){if($('#text_flyer_select option:selected').val()=='0'){$('#status_messages').html("<label style='color: #9BCC60;'>Messages: Please select a flyer first!</label>");return false;}LaunchEditorModal($('#text_image_flyer_select option:selected').val(),'text',true);});$('#text_image_preview').click(function(){if($('#text_image_flyer_select option:selected').val()=='0'){$('#status_messages').html("<label style='color: #9BCC60;'>Messages: Please select a flyer first!</label>");return false;}window.open('generate.php?flyerid='+$('#text_image_flyer_select option:selected').val(),null,'height=600,width=800,status=no,toolbar=no,menubar=no,location=no');});$('#text_image_edit').click(function(){if($('#text_image_flyer_select option:selected').val()=='0'){$('#status_messages').html("<label style='color: #9BCC60;'>Messages: Please select a flyer first!</label>");return false;}LaunchEditorModal($('#text_image_flyer_select option:selected').val(),'text_image',false);});$('#text_image_remove').click(function(){if($('#text_image_flyer_select option:selected').val()=='0'){$('#status_messages').html("<label style='color: #9BCC60;'>Messages: Please select a flyer first!</label>");return false;}LaunchEditorModal($('#text_image_flyer_select option:selected').val(),'text_image',true);});$('#image_preview').click(function(){if($('#image_flyer_select option:selected').val()=='0'){$('#status_messages').html("<label style='color: #9BCC60;'>Messages: Please select a flyer first!</label>");return false;}window.open('generate.php?flyerid='+$('#image_flyer_select option:selected').val(),null,'height=600,width=800,status=no,toolbar=no,menubar=no,location=no');});$('#image_edit').click(function(){if($('#image_flyer_select option:selected').val()=='0'){$('#status_messages').html("<label style='color: #9BCC60;'>Messages: Please select a flyer first!</label>");return false;}LaunchEditorModal($('#image_flyer_select option:selected').val(),'image',false);});$('#image_remove').click(function(){if($('#image_flyer_select option:selected').val()=='0'){$('#status_messages').html("<label style='color: #9BCC60;'>Messages: Please select a flyer first!</label>");return false;}LaunchEditorModal($('#text_image_flyer_select option:selected').val(),'image',true);});}function ActivateBoardSelectableContent(){$(function(){$('#flyer_radio').buttonset();});$('#flyer_preview').click(function(){if($('#flyer_select option:selected').val()=='0'){$('#status_messages').html("<label style='color: #9BCC60;'>Messages: Please select a flyer first!</label>");return false;}window.open('generate.php?flyerid='+$('#flyer_select option:selected').val(),null,'height=600,width=800,status=no,toolbar=no,menubar=no,location=no');});$('#flyer_approve').click(function(){if($('#flyer_select option:selected').val()=='0'){$('#status_messages').html("<label style='color: #9BCC60;'>Messages: Please select a flyer first!</label>");return false;}ApprovePost(($('#flyer_select option:selected').attr('id')),true);});$('#flyer_remove').click(function(){if($('#flyer_select option:selected').val()=='0'){$('#status_messages').html("<label style='color: #9BCC60;'>Messages: Please select a flyer first!</label>");return false;}ApprovePost(($('#flyer_select option:selected').attr('id')),false);});}function LaunchEditorModal(flyer_id,page,is_remove){if(is_remove==false){$.ajax({url:"flyer_editor.php",type:'post',data:{template:page,users_flyer_id:$('#'+page+'_flyer_select option:selected').val()},success:function(data){$("#modal_editor").html(data);}});$("#modal_editor").dialog({autoOpen:false,cache:false,modal:true,height:565,width:550,draggable:false,resizable:false,title:'Updating Flyer: '+$('#'+page+'_flyer_select option:selected').html(),close:function(){toggleManagerActionsOff();}});$("#modal_editor").dialog("open");}else
{PendingPurgeFlyer(page);$("#modal_remove").dialog({resizable:false,autoOpen:false,height:250,cache:false,width:250,modal:true,buttons:{Delete:function(){if(PurgeFlyer(flyer,page)==true){$(this).dialog("close");toggleManagerActionsOff();$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Flyer removal was a success!</label>");RequestPageByAjaxGet('flyer_manager');}},Cancel:function(){toggleManagerActionsOff();$(this).dialog("close");}}});$("#modal_remove").dialog("open");}}function PendingPurgeFlyer(page){$.ajax({url:"flyer_remove.php",type:'post',data:{template:page,users_flyer_id:$('#'+page+'_flyer_select option:selected').val(),is_purge:'false'},success:function(data){flyer=data;flyer['type']=page;$('#ltitle').html(flyer['title']);$('#modal_remove').dialog("option","title",'Remove Flyer -> '+flyer['title']);}});}function PurgeFlyer(data,page){$.ajax({url:"flyer_remove.php",type:'post',data:{template:page,flyer:flyer,is_purge:'true'},beforeSend:function(){$("#modal_remove").mask("Removing...");},error:function(data){$("#modal_remove").html(data);},success:function(data){$("#modal_remove").unmask();}});return true;}function LoadAddButton(){$(function(){$("#add_button").button({icons:{primary:"ui-icon-plus"},text:false})});}function LoadRemoveButton(id){$(function(){$("#"+id).button({icons:{primary:"ui-icon-minus"},text:true})});}function RemovePost(id){$.ajax({url:"post_remove.php",type:'post',cache:false,data:{id:id},beforeSend:function(){$("#column").mask("Removing...");},error:function(data){$("#column").html(data);},success:function(data){$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Post has been removed from this board</label>");RefreshPostList();$("#column").unmask();},});return true;}function ApprovePost(id,is_approve){$.ajax({url:"post_approve.php",type:'post',cache:false,data:{id:id,is_approve:is_approve},beforeSend:function(){$("#tabs").mask("updating...");},error:function(data){$("#tabs").html(data);},success:function(data){$("#tabs").unmask();if(is_approve==true)$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Post has been <i>approved</i> for this board</label>");else
$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Post is set to <i>not approved</i> for this board</label>");RefreshPostList();},});return true;}function RemoveManagerPost(id){$.ajax({url:"post_remove.php",type:'post',cache:false,data:{id:id},beforeSend:function(){$("#tabs").mask("Removing...");},error:function(data){$("#tabs").html(data);},success:function(data){$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Post has been removed from this board</label>");$("#tabs").tabs("load",4);$("#tabs").unmask();},});return true;}function RefreshPostList(){$.ajax({url:"post_refresh.php",type:'post',cache:false,beforeSend:function(){$("#column").mask("Updating...");},error:function(data){$("#column").html(data);},success:function(data){$("#column").html(data);$("#column").unmask();}});return true;}function InitializeMapsAPI(address){var latlng=new google.maps.LatLng();var geocoder=new google.maps.Geocoder();geocoder.geocode({'address':address},function(data,status){latlng=data[0].geometry.location;var myOptions={zoom:10,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP};var map=new google.maps.Map(document.getElementById("map_canvas"),myOptions);var marker=new google.maps.Marker({position:latlng,animation:google.maps.Animation.DROP,title:"Starbucks of Cambridge"});marker.setMap(map);});LoadTableEntry(address);}function LoadTableEntry(address){var location={address_line:address.toString().split(',')[0],city:address.toString().split(',')[1],state:address.toString().split(',')[2],zip:address.toString().split(',')[3],board_id:address.toString().split(',')[4],permission:address.toString().split(',')[5]}$("#table_address").html(location.address_line+"<br>"+location.city+", "+location.state+"<br>"+location.zip);$("#table_permission").html(location.permission);$("#add_button").val(location.board_id);$("#flyers").attr("disabled",false);}function toggleAndLoadBoard(value){if(value=='create'){LoadNewBoardPreferences();}else
{$('#tabs').toggleClass('ui-helper-hidden',false);LoadBoardManagerTabs(value);$('#tabs').tabs("option","selected",0);}}function LoadBoardManagerTabs(value){$(function(){$("#tabs").tabs({ajaxOptions:{type:'get',data:{board_id:value},success:function(data){},error:function(xhr,status,index,anchor){$(anchor.hash).html("Couldn't load this tab. We'll try to fix this as soon as possible. "+"If this wouldn't be a demo.");}}});});}function LoadNewBoardPreferences(){RequestBoardByAjaxPost('create');$("#modal_board_preferences").dialog({autoOpen:false,cache:false,modal:true,height:565,width:550,draggable:false,resizable:false,title:'New Board',close:function(){}});$("#modal_board_preferences").dialog("open");}function loadDatePicker(){$(function(){$('#event_date').datepicker();});}function RequestPageByAjaxGet(page){$.ajax({url:page+".php",cache:false,beforeSend:function(){$("#content").mask("loading...");},success:function(data){$("#content").unmask();cleanContentAndFormFields();$("#content").html(data);}});return false;}function SubmitFormByAjaxPost(page){$.ajax({url:"flyer_creation.php",type:"post",data:{title:$("#title").val(),description:$("#description").val(),location:$("#location").val(),event_date:$("#event_date").val(),contact_id:$("#contact").val(),contact_name:$("#contact_name").val(),contact_info:$("#contact_info").val(),enable_qr:$("#enable_qr").val(),image_meta_data:image_meta_data,flyer_type:page},beforeSend:function(){$("#form_content").mask("creating...");},success:function(data){$("#form_content").unmask();$('#status_messages').toggleClass('ui-helper-hidden',false);$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Flyer successfully inserted, go to flyer manager to edit text or remove flyer, or Post Flyer to post to a board.</label>");},error:function(data){$("#form_content").unmask();$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Flyer insertion failed, please try again later</label>");},complete:function(){RequestFormByAjaxPost(page);$('#form_content').unmask();}});return false;}function SubmitBoardByAjaxPost(){$.ajax({url:"board_creation.php",type:"post",data:{title:$("#title").val(),description:$("#desc").val(),address:$("#address").val(),city:$("#city").val(),state:$("#state").val(),zipcode:$("#zipcode").val(),permissions:$('input[name=permissions]:checked').val(),flyerexpire:$("#flyerexpire").val(),shuffle:$("#shuffle").val(),interval:$("#interval").val(),postperspace:$("#postpayment option:selected").val(),cashmount:$("#cashamount").val(),flyerdays:$("#flyerdays").val()},beforeSend:function(){$("#new_board").mask("creating...");},success:function(data){$("#new_board").unmask();$('#status_messages').toggleClass('ui-helper-hidden',false);$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Board successfully created</label>");},error:function(data){$("#new_board").unmask();$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Board creation failed, please try again later</label>");},complete:function(data){RequestPageByAjaxGet('board_manager');$("#modal_board_preferences").dialog("close");$('#new_board').unmask();}});return false;}function PreparePurgeBoard(){var id=$('#board_select option:selected').val();$("#modal_remove").dialog({resizable:false,autoOpen:false,height:250,cache:false,width:250,modal:true,buttons:{Delete:function(){if(PurgeBoard()==true){$(this).dialog("close");toggleManagerActionsOff();$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Board removal was a success!</label>");RequestPageByAjaxGet('board_manager');}},Cancel:function(){$(this).dialog("close");}}});$("#modal_remove").dialog("open");}function PurgeBoard(){var id=$('#board_select option:selected').val();$.ajax({url:"board_remove.php",type:'post',cache:false,data:{id:id},beforeSend:function(){$("#modal_remove").mask("Removing...");},error:function(data){$("#modal_remove").html(data);},success:function(data){$("#modal_remove").unmask();}});return true;}function LaunchFlyerPortables(){$(function(){$(".column").sortable({connectWith:".column"});$(".portlet").addClass("ui-widget ui-widget-content ui-helper-clearfix ui-corner-all").find(".portlet-header").addClass("ui-widget-header ui-corner-all").prepend("<span class='ui-icon ui-icon-minusthick'></span>").end().find(".portlet-content");$(".portlet-header .ui-icon").click(function(){$(this).toggleClass("ui-icon-minusthick").toggleClass("ui-icon-plusthick");$(this).parents(".portlet:first").find(".portlet-content").toggle();});$(".column").disableSelection();});}function UpdateBoardByAjaxPost(board_id,page){var updates=[];switch(page){case"general":updates={id:$("#id").val(),page:page,title:$("#title").val(),description:$("#desc").val(),address:$("#address").val(),city:$("#city").val(),state:$("#state").val(),zipcode:$("#zipcode").val(),}break;case"permission":updates={id:$("#id").val(),page:page,permissions:$('input[name=permissions]:checked').val()}break;case"posting":updates={id:$("#id").val(),page:page,flyerexpire:$("#flyerexpire").val(),shuffle:$("#shuffle").val(),interval:$("#interval").val(),postperspace:$("#postpayment option:selected").val(),cashamount:$("#cashamount").val(),flyerdays:$("#flyerdays").val()}break;}$.ajax({url:"board_update.php",type:"post",data:{updates:updates},beforeSend:function(){$("#tabs").mask("updating...");},success:function(data){$("#tabs").unmask();$('#status_messages').toggleClass('ui-helper-hidden',false);$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Board successfully updated</label>");},error:function(data){$("#tabs").unmask();$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Board update failed, please try again later</label>");},complete:function(data){$("#dialog-message").html("<label style='color: #9BCC60;'>Board successfully updated</label>");$("#dialog-message").dialog({modal:true,resizable:false,buttons:{ok:function(){$(this).dialog("close");}}});$('#tabs').unmask();}});return false;}function UpdateLocationsByAjaxPost(state_id){$.ajax({url:"post_location_update.php",type:"post",data:{state_id:state_id},beforeSend:function(){$("#locations").mask("updating...");},success:function(data){$("#locations").unmask();$("#locations").html(data);},error:function(data){$("#locations").unmask();$("#status_messages").html("<label style='color: #9BCC60;'>Messages: location update failed, please try again later</label>");}});}function PostToLocation(board_id){if(board_id==0){alert("Please select a board to post to!");return false;}if($("#flyers option:selected").val()==0){alert("Please select a flyer to post!");return false;}var post_status_desc=$("#table_permission").html();var post_status_id=1;switch(post_status_desc){case"Public":post_status_id=1;break;case"By Approval ":post_status_id=2;break;}console.log(post_status_id);$.ajax({url:"post_to_location.php",type:"post",data:{boardid:board_id,users_flyer_id:$("#flyers option:selected").val(),post_status_id:post_status_id},beforeSend:function(){$("#locations").mask("updating...");},success:function(data){$("#locations").unmask();RefreshPostList();},error:function(data){$("#locations").unmask();$("#status_messages").html("<label style='color: #9BCC60;'>Messages: location update failed, please try again later</label>");}});}function UpdateFormByAjaxPost(page){$.ajax({url:"flyer_edit.php",cache:false,type:"post",data:{title:$("#title").val(),description:$("#description").val(),location:$("#location").val(),event_date:$("#event_date").val(),contact_id:$("#contact").val(),contact_name:$("#contact_name").val(),contact_info:$("#contact_info").val(),enable_qr:$("#enable_qr").val(),flyer_id:$("#flyer_id").val(),flyer_type:page},beforeSend:function(){$("#modal_editor").mask("updating...");},success:function(data){$("#modal_editor").unmask();$('#status_messages').toggleClass('ui-helper-hidden',false);$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Flyer update was a success!</label>");},error:function(data){$("#modal_editor").unmask();$("#status_messages").html("<label style='color: #9BCC60;'>Messages: Flyer update was fail, please try again later!</label>");},complete:function(){$("#modal_editor").dialog("close");RequestPageByAjaxGet('flyer_manager');$('#modal_editor').unmask();}});return false;}function RequestFormByAjaxPost(page){$.ajax({url:"flyer_constructor.php",type:'post',cache:false,data:{template:page},beforeSend:function(){$("#form_content").mask("loading...");},success:function(data){$("#form_content").unmask();$("#form_content").html(data);}});return false;}function RequestBoardByAjaxPost(page){$.ajax({url:"board_constructor.php",type:'get',data:{template:page},beforeSend:function(){$("#modal_board_preferences").mask("loading...");},success:function(data){$("#form_content").unmask();$("#modal_board_preferences").html(data);}});return false;}function GenerateBoard(board_id){$.ajax({url:"generate_board.php",type:'post',data:{board_id:board_id},beforeSend:function(){},success:function(data){console.log(data);}});}