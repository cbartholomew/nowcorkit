
(function(){image_meta_data={id:null,cork_id:null,type:null,size:null,name:null,location:null};function $id(id){return document.getElementById(id);}function Output(msg){var m=$id("messages");m.innerHTML=msg;}function FileDragHover(e){e.stopPropagation();e.preventDefault();e.target.className=(e.type=="dragover"?"hover":"");}function FileSelectHandler(e){FileDragHover(e);var files=e.target.files||e.dataTransfer.files;f=files[0];ParseFile(f);UploadFile(f);}function ParseFile(file){Output("<p>File information: <strong>"+file.name+"</strong> type: <strong>"+file.type+"</strong> size: <strong>"+file.size+"</strong> bytes</p>");if(file.type.indexOf("image")==0){var reader=new FileReader();reader.onload=function(e){Output("<p><strong>"+file.name+":</strong><br />"+'<img src="'+e.target.result+'" /></p>');}reader.readAsDataURL(file);}if(file.type.indexOf("text")==0){var reader=new FileReader();reader.onload=function(e){Output("<p><strong>"+file.name+":</strong></p><pre>"+e.target.result.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</pre>");}reader.readAsText(file);}}function UploadFile(file){var xhr=new XMLHttpRequest();if(xhr.upload&&file.type=="image/jpeg"||"image/png"||"image/gif"&&file.size<=$id("MAX_FILE_SIZE").value){image_meta_data={id:null,cork_id:null,type:file.type,size:file.size,name:file.name,location:"flyers/images/"};var o=$id("progress");var progress=o.appendChild(document.createElement("p"));progress.appendChild(document.createTextNode("upload "+file.name));xhr.upload.addEventListener("progress",function(e){var pc=parseInt(100-(e.loaded/e.total*100));progress.style.backgroundPosition=pc+"% 0";},false);xhr.onreadystatechange=function(e){if(xhr.readyState==4){progress.className=(xhr.status==200?"success":"failure");}};xhr.open("POST",$id("upload").action,true);xhr.setRequestHeader("X_FILENAME",file.name);xhr.send(file);}}function Init(){var fileselect=$id("fileselect"),filedrag=$id("filedrag"),submitbutton=$id("submitbutton");fileselect.addEventListener("change",FileSelectHandler,false);var xhr=new XMLHttpRequest();if(xhr.upload){filedrag.addEventListener("dragover",FileDragHover,false);filedrag.addEventListener("dragleave",FileDragHover,false);filedrag.addEventListener("drop",FileSelectHandler,false);filedrag.style.display="block";submitbutton.style.display="none";}}if(window.File&&window.FileList&&window.FileReader){Init();}})();